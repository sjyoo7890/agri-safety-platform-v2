# 비기능 요구사항 (NFR)

## 1. 성능 요구사항

| ID | 항목 | 목표값 | 비고 |
|----|------|-------|------|
| NFR-PERF-001 | 센서 데이터 수집 성공률 | 1단계: 95% 이상 / 2단계: 100% | DB 및 로그 기반 측정 |
| NFR-PERF-002 | 위험 알림 지연 시간 | 1단계: 3초 이내 / 2단계: 2초 이내 | AI 판단 후 작업자 디바이스 도달까지 |
| NFR-PERF-003 | 데이터 전송 지연 | 1단계: 3초 / 2단계: 2초 이내 | 센서 이벤트 → 서버DB 저장 시간 |
| NFR-PERF-004 | 오경보율 | 1단계: 10% 미만 / 2단계: 5% 미만 | 전체 알림 대비 실제 사고 아님 비율 |
| NFR-PERF-005 | 대시보드 페이지 로드 | 3초 이내 | 초기 렌더링 완료 기준 |
| NFR-PERF-006 | 동시 접속 사용자 | 최소 200명 | 오토스케일링 기반 |
| NFR-PERF-007 | 실시간 데이터 갱신 주기 | 5초 이내 | WebSocket 기반 실시간 업데이트 |

## 2. 보안 요구사항

| ID | 항목 | 상세 설명 |
|----|------|----------|
| NFR-SEC-001 | 인증/인가 | OAuth 2.0 + JWT 기반 인증. RBAC(Role-Based Access Control) 적용 |
| NFR-SEC-002 | 데이터 암호화 | 전송 구간 TLS 1.3, 저장 구간 AES-256 암호화 (생체정보, 위치정보) |
| NFR-SEC-003 | 개인정보보호 | 개인정보보호법 준수. 작업자 생체/위치 정보 수집 동의 관리. 익명화 처리 |
| NFR-SEC-004 | 감사 추적 | 모든 데이터 접근 및 변경에 대한 감사 로그 기록 및 90일 이상 보존 |
| NFR-SEC-005 | 취약점 점검 | 주기적 모의 해킹 실시 및 보안 패치 적용 프로세스 수립 |

### 보안 구현 체크리스트
- [ ] JWT access token 만료: 15분
- [ ] JWT refresh token 만료: 7일 (HttpOnly Cookie)
- [ ] bcrypt salt rounds: 12
- [ ] Rate limiting: 로그인 5회/분, API 100회/분
- [ ] CORS: 허용 도메인 화이트리스트
- [ ] Helmet.js: HTTP 보안 헤더
- [ ] SQL Injection 방지: TypeORM 파라미터 바인딩
- [ ] XSS 방지: React 자동 이스케이핑 + DOMPurify
- [ ] CSRF: SameSite Cookie 설정
- [ ] 파일 업로드: 확장자/크기 제한, 바이러스 스캔

## 3. 가용성 및 확장성

| ID | 항목 | 상세 설명 |
|----|------|----------|
| NFR-AVL-001 | 서비스 가용률 | 99.5% 이상 (연간 다운타임 43시간 이내) |
| NFR-AVL-002 | 오토스케일링 | 농번기/농한기 트래픽 변동에 따른 서버 자원 자동 확장/축소 |
| NFR-AVL-003 | 데이터 백업 | 일일 자동 백업, 30일 이상 보존, 재해복구(DR) 계획 수립 |
| NFR-AVL-004 | 수평 확장 | 마이크로서비스 단위 독립 배포 및 확장 가능한 아키텍처 |

### 인프라 구성
```
[클라이언트]
    ↓
[Nginx] - 리버스 프록시, SSL 종단, 정적 파일 서빙
    ↓
[NestJS 앱] ×N (Docker 컨테이너, 수평 확장)
    ↓
[PostgreSQL] - Primary + Replica (읽기 분산)
[TimescaleDB] - 센서 데이터 전용
[Redis] - 세션/캐시/Pub-Sub
[Mosquitto] - MQTT 브로커
    ↓
[AI Service] - FastAPI (별도 컨테이너, GPU 옵션)
```

### Docker Compose 서비스 목록
| 서비스 | 이미지 | 포트 | 용도 |
|--------|-------|------|------|
| nginx | nginx:alpine | 80, 443 | 리버스 프록시 |
| frontend | node:20-alpine (빌드) | 3000 → nginx | React 앱 |
| backend | node:20-alpine | 4000 | NestJS API |
| ai-service | python:3.11-slim | 8000 | FastAPI AI 서비스 |
| postgres | postgres:16 | 5432 | 관계형 DB |
| timescaledb | timescale/timescaledb:latest-pg16 | 5433 | 시계열 DB |
| redis | redis:7-alpine | 6379 | 캐시/세션 |
| mosquitto | eclipse-mosquitto:2 | 1883, 9001 | MQTT 브로커 |

## 4. UI/UX 요구사항

| ID | 항목 | 상세 설명 |
|----|------|----------|
| NFR-UX-001 | 반응형 디자인 | PC, 태블릿, 모바일 환경에 최적화된 반응형 레이아웃 |
| NFR-UX-002 | 접근성 | WCAG 2.1 AA 수준 준수. 고령자 대상 큰 글씨, 고대비, 직관적 아이콘 적용 |
| NFR-UX-003 | 다국어 지원 | 한국어 기본, 향후 영어 지원 확장 고려한 i18n 구조 |
| NFR-UX-004 | 브라우저 호환성 | Chrome, Edge, Safari 최신 2개 버전 지원 |

### 반응형 브레이크포인트
| 뷰포트 | 분류 | 레이아웃 |
|--------|------|---------|
| ≥1440px | 대형 모니터 | 대시보드 풀 레이아웃 (지도 + 사이드 패널 + 하단 타임라인) |
| ≥1024px | 태블릿/소형 모니터 | 2컬럼 (지도 + 패널) |
| ≥768px | 태블릿 세로 | 탭 기반 전환 (지도/센서/작업자) |
| < 768px | 모바일 | 작업자용 모바일 웹 (FR-MOB) |

## 5. 주요 KPI 목표

| 구분 | 지표 | 1단계 목표 | 2단계 목표 |
|------|------|-----------|-----------|
| AI 모델 | 추락/넘어짐 예측 정확도 | 99.5% 이상 | 99.5% 이상 |
| AI 모델 | 끼임/감김 판별 정확도 | 99.9% 이상 | 99.9% 이상 |
| AI 모델 | 온열질환 예측 정확도 (AUROC) | - | 91% 이상 |
| AI 모델 | 전기화재 예측 정확도 | 99.5% 이상 | 99.5% 이상 |
| AI 모델 | 차량 전복 예측 오차 | - | 0.0065 rad 이내 |
| AI 모델 | 농기계-작업자 충돌 탐지 | 94% 이상 | 96% 이상 |
| 시스템 | 센서 데이터 수집 성공률 | 95% | 100% |
| 시스템 | 위험 알림 지연 시간 | 3초 | 2초 |
| 시스템 | 오경보율 | 10% 미만 | 5% 미만 |
| 디바이스 | 스마트조끼 위험감지 정확도 | 85% | 90% |
| 디바이스 | 스마트조끼 배터리 동작시간 | 5시간 | 8시간 |
| 디바이스 | 응급키트 통신 성공률 | 90% | 95% |
| 시뮬레이터 | 프레임 안정성 (Min FPS) | 60fps | 90fps |
| 시뮬레이터 | 체감 지연 시간 | 150ms | 120ms |

## 6. 리스크 및 제약사항

### 주요 리스크
| 리스크 | 영향도 | 대응 방안 |
|--------|-------|----------|
| 농업 현장 통신 환경 불안정 | 상 | 하이브리드 통신(LTE Cat.M1 + LoRa + BLE) 적용, 오프라인 버퍼링 기능, Edge 전처리 |
| 고령 사용자 디지털 리터러시 부족 | 상 | 실버 친화적 UI/UX 설계, TTS 음성 안내, 현장 사용성 테스트 반복 실시 |
| 실제 사고 데이터 희소성 | 중 | 공개 데이터셋 활용 사전학습, 모의 실험 데이터 생성, 능동적 학습 파이프라인 구축 |
| IoT 디바이스 오작동/False Alarm | 중 | 현장 노이즈 필터링 알고리즘, 하이브리드 판단 엔진(규칙+AI), 오경보 피드백 루프 |
| 개인정보 보호 규정 준수 | 중 | 생체/위치 정보 수집 동의 관리, 데이터 암호화, 익명화 처리, 법률 자문 |
| 다수 농가 동시 서비스 시 성능 저하 | 중 | 클라우드 오토스케일링, DB 샤딩, 부하 분산, 성능 테스트 정기 실시 |

### 제약사항
- 1단계(2026~2028)는 공개 데이터셋 중심 AI 학습, 2단계(2029~2030)부터 실증 농가 데이터 활용
- 실증 농가는 전라도 일대 과수/축산/노지 3개소로 한정 (전북농업기술원 협력)
- 4D 시뮬레이터 교육 콘텐츠는 시도군 농업기술센터, 교육장 등에서만 운영
- 농업인안전365 플랫폼 연계는 2단계 2차년도(2030)에 구현
- 웹 시스템은 한국어 우선 개발, 다국어 지원은 후속 과제에서 검토
