# FR-AI / FR-DRA: AI 사고 예측/판별 및 동적 위험성평가

## 모듈 개요
6대 사고유형에 대한 AI 예측 모델의 결과를 시각화하고, XAI(설명 가능한 AI) 분석 결과를 표시하며, 동적 위험성평가(DRA) 엔진의 실시간 위험 등급과 감소대책을 관리하는 모듈.

## 접근 권한
- 시스템 관리자: 전체 조회 + 모델 관리
- 농장 관리자: 소속 농장 예측 결과 조회
- 지자체 관리자: 관할 지역 통계 조회

## 기능 요구사항

### AI 사고 예측/판별 관리 (FR-AI)

| ID | 요구사항 | 우선순위 | 상세 설명 |
|----|---------|---------|----------|
| FR-AI-001 | 6대 사고유형 예측 현황 | 상 | 추락/넘어짐, 끼임/감김, 온열질환/질식, 전기화재, 차량전복, 농기계충돌 각 모델의 실시간 예측 결과를 통합 표시 |
| FR-AI-002 | 위험도 스코어 시각화 | 상 | 각 사고유형별 위험도 점수(0~100)를 게이지 차트 또는 레이더 차트로 시각화 |
| FR-AI-003 | XAI 분석결과 표시 | 상 | SHAP/LIME 분석 기반 사고 위험 기여 요인을 막대 차트 및 텍스트로 표시 (예: 합성 가속도 42%, 자세 변화각 28%) |
| FR-AI-004 | LLM 기반 자연어 알림 | 중 | AI 예측 결과를 LLM을 통해 자연어로 변환한 경고 메시지 표시 (예: '작업자가 사다리 작업 중 약 1.5m 높이에서 추락 충격이 감지되었습니다') |
| FR-AI-005 | 모델 성능 모니터링 | 중 | 각 AI 모델의 정확도(Accuracy), AUROC, RMSE 등 성능 지표를 대시보드에 표시. 성능 저하 시 알림 |
| FR-AI-006 | 오경보 관리 | 중 | False Alarm 이벤트에 대한 사후 검토/확인 기능. 오경보 비율 통계 제공 |

### 동적 위험성평가 관리 (FR-DRA)

| ID | 요구사항 | 우선순위 | 상세 설명 |
|----|---------|---------|----------|
| FR-DRA-001 | 실시간 위험등급 판정 화면 | 상 | 정상→주의→경고→위험 4단계 위험등급을 실시간 산출하여 대시보드에 표시. 등급 변경 시 즉시 갱신 |
| FR-DRA-002 | 위험요인 추천 목록 | 상 | 온톨로지/지식그래프 기반 현재 상황에서의 잠재적 위험요인을 자동 추천 표시 |
| FR-DRA-003 | 감소대책 즉시 제공 | 상 | 위험 상황 발생 시 온톨로지에 등록된 구체적 행동 지침(엔진 정지, 즉시 환기 등)을 작업자 및 관리자에게 팝업/푸시로 전달 |
| FR-DRA-004 | 위험성평가 이력 조회 | 중 | 과거 위험성평가 결과 이력을 날짜/장소/사고유형별로 검색 및 조회 |

## 6대 사고유형별 AI 모델 상세

| 코드 | 사고유형 | 주요 입력 | 모델 기법 | 목표 정확도 |
|------|---------|----------|-----------|------------|
| FALL | 추락/넘어짐 | IMU 합성 가속도, 자세 변화각, 고도 변화 | CNN-LSTM 하이브리드 | 99.5% |
| ENTANGLE | 끼임/감김 | CCTV 영상, 근접 센서, 진동 패턴 | YOLOv8 + 시계열 분류 | 99.9% |
| HEAT | 온열질환/질식 | 체온, 심박, WBGT, 누적작업시간, 가스농도 | XGBoost + LSTM | AUROC 91% |
| FIRE | 전기화재 | 전류, 전압, 온도, 아크 신호, 절연저항 | 1D-CNN + 이상탐지 | 99.5% |
| ROLLOVER | 차량 전도/전복 | IMU Roll/Pitch/Yaw, 속도, 조향각, 하중 | 물리엔진 + ML 하이브리드 | 오차 0.0065 rad |
| COLLISION | 농기계-작업자 충돌 | UWB 거리, LiDAR 포인트클라우드, 카메라 | 3D Object Detection + TTC 계산 | 96% |

## 화면 구성 가이드

### AI 사고 예측 현황
```
┌──────────────────────────────────────────────────────┐
│ AI 사고 예측 현황 - 농장명                             │
├──────────────────────────────────────────────────────┤
│  6대 사고유형 위험도 레이더 차트    │ XAI 기여요인       │
│  ┌─────────────────────┐          │ ┌───────────────┐ │
│  │    FALL              │          │ │ 합성가속도 42% │ │
│  │   /    \             │          │ │ 자세변화  28% │ │
│  │ COLLISION  ENTANGLE  │          │ │ 고도변화  15% │ │
│  │   \    /             │          │ │ 작업시간  10% │ │
│  │  ROLLOVER            │          │ │ 기타       5% │ │
│  │   /    \             │          │ └───────────────┘ │
│  │  FIRE    HEAT        │          │                   │
│  └─────────────────────┘          │ LLM 알림 메시지    │
│                                   │ "작업자 홍길동의    │
│                                   │  추락 위험도가 72로 │
│                                   │  상승했습니다..."   │
├──────────────────────────────────────────────────────┤
│  동적 위험성평가 현황                                  │
│  현재 등급: 🟠 경고 (67/100)                          │
│  위험요인: 고온(WBGT 31℃), 사다리 작업, 장시간 연속작업 │
│  감소대책: ① 즉시 휴식 ② 그늘 이동 ③ 수분 섭취        │
├──────────────────────────────────────────────────────┤
│  모델 성능 │ Accuracy │ AUROC │ 오경보율 │ 상태      │
│  FALL     │ 99.5%    │ 0.998 │ 3.2%    │ 🟢 정상   │
│  ENTANGLE │ 99.9%    │ 0.999 │ 1.1%    │ 🟢 정상   │
│  HEAT     │ 95.2%    │ 0.912 │ 8.4%    │ 🟡 주의   │
└──────────────────────────────────────────────────────┘
```

## 관련 API
| Method | Endpoint | 설명 |
|--------|----------|------|
| GET | `/api/v1/predictions/realtime` | 6대 사고유형 실시간 예측 결과 |
| GET | `/api/v1/predictions/{id}/xai` | XAI 분석 결과 (SHAP/LIME 기여요인) |
| GET | `/api/v1/predictions/models/performance` | AI 모델 성능 지표 |
| POST | `/api/v1/predictions/{id}/false-alarm` | 오경보 마킹/피드백 |
| GET | `/api/v1/risk-assessment/current` | 현재 동적 위험성평가 결과 |
| GET | `/api/v1/risk-assessment/history?from=&to=` | 위험성평가 이력 조회 |
| GET | `/api/v1/risk-assessment/hazards` | 위험요인 추천 목록 |
| GET | `/api/v1/risk-assessment/countermeasures` | 감소대책 목록 |

## 기술 구현 힌트
- **레이더 차트**: Recharts RadarChart로 6축(사고유형) 위험도 표시
- **XAI 차트**: Recharts 수평 BarChart, SHAP 값 크기순 정렬
- **LLM 메시지**: AI 서비스(FastAPI)가 생성하여 `/predictions/{id}/llm-message` 로 제공
- **위험등급 게이지**: 0~100 반원 게이지, 색상 그라디엔트 (녹→황→주→적)
- **위험성평가**: AI 서비스에서 온톨로지/지식그래프 쿼리 → 위험요인 + 감소대책 JSON 반환
