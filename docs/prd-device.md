# FR-DEV / FR-KIT / FR-ENV: IoT 디바이스 관리

## 모듈 개요
스마트 안전조끼, 스마트 응급키트, 환경 센서 등 모든 IoT 디바이스의 등록, 배정, 상태 모니터링, 유지보수를 관리하는 모듈.

## 접근 권한
- 시스템 관리자: 전체 장비 CRUD
- 농장 관리자: 소속 농장 장비 조회 및 배정 관리
- 작업자: 본인 배정 장비 상태 조회 (모바일 웹)

## 기능 요구사항

### 스마트 조끼 관리 (FR-DEV)

| ID | 요구사항 | 우선순위 | 상세 설명 |
|----|---------|---------|----------|
| FR-DEV-001 | 조끼 등록 및 배정 | 상 | 스마트 조끼 개별 등록(시리얼번호, 모듈 타입), 작업자별 배정/회수 관리 |
| FR-DEV-002 | 모듈 상태 모니터링 | 상 | 장착된 센서 모듈(노지용/축산용/과수용) 타입 및 센서 정상 작동 여부 실시간 표시 |
| FR-DEV-003 | 배터리 상태 관리 | 상 | 잔여 배터리 레벨 실시간 표시. 배터리 부족 시 관리자에게 알림 전송 |
| FR-DEV-004 | 통신 상태 확인 | 상 | 조끼의 BLE/LoRa/LTE 통신 연결 상태를 실시간 표시. 통신 끊김 시 경고 |
| FR-DEV-005 | 센서 캘리브레이션 기록 | 중 | 가스센서 등 주기적 교정이 필요한 센서의 캘리브레이션 이력 관리 |

### 스마트 조끼 모듈 유형
| 모듈 타입 | 코드 | 탑재 센서 |
|----------|------|----------|
| 노지용 | `open_field` | IMU(9축), 심박, 체온, GPS, BLE, LoRa |
| 축산용 | `livestock` | 위 + 가스센서(O2, H2S, NH3, CH4), 온습도 |
| 과수용 | `orchard` | 위 + 고도센서, 자세감지 강화(사다리 작업) |

### 스마트 응급키트 관리 (FR-KIT)

| ID | 요구사항 | 우선순위 | 상세 설명 |
|----|---------|---------|----------|
| FR-KIT-001 | 응급키트 등록 및 위치 관리 | 상 | 거치형/차량탑재형 응급키트 등록. 설치 위치를 지도 위에 표시 |
| FR-KIT-002 | 개폐 상태 모니터링 | 상 | 응급키트 개폐 이벤트 실시간 감지 및 로그 기록. 비정상 개방 시 즉시 알림 |
| FR-KIT-003 | 구급용품 재고 관리 | 중 | PCM 쿨링팩, 지혈대 등 구급용품 사용/보충 이력 관리 |
| FR-KIT-004 | 농기계 전복 연동 | 상 | 차량용 응급키트의 전복 감지 센서 연동 - 자동 잠금 해제 및 E-Call 트리거 상태 표시 |

### 응급키트 유형
| 유형 | 코드 | 특징 |
|------|------|------|
| 거치형 | `wall_mounted` | 벽면 설치, IP67 방수방진, PCM 쿨링팩/심장충격기(AED) 보관 |
| 차량탑재형 | `vehicle_mounted` | 농기계 장착, 전복 감지 시 자동 잠금 해제, E-Call 연동 |

### 환경 센서 관리 (FR-ENV)

| ID | 요구사항 | 우선순위 | 상세 설명 |
|----|---------|---------|----------|
| FR-ENV-001 | 환경센서 등록 및 배치 | 상 | 온습도, 가스, 전류/전압 센서 등록 및 농작업장 내 설치 위치 관리 |
| FR-ENV-002 | 환경 데이터 트렌드 | 상 | 시간별/일별 온도, 습도, WBGT, 유해가스 농도 추이 차트 표시 |
| FR-ENV-003 | 임계값 설정 관리 | 상 | 센서별 위험 임계값(예: O2 < 18%, H2S > 10ppm) 설정 및 관리 화면 |
| FR-ENV-004 | 센서 이상 감지 | 상 | 센서 데이터 수신 중단, 이상값 지속 발생 등 센서 이상 상태를 자동 감지하여 알림 |

### 주요 환경 센서 임계값 기본값
| 센서 | 주의 | 경고 | 위험 |
|------|------|------|------|
| 온도 (WBGT) | 25℃ | 29℃ | 33℃ |
| 산소 (O2) | < 19.5% | < 18% | < 16% |
| 황화수소 (H2S) | 5 ppm | 10 ppm | 20 ppm |
| 암모니아 (NH3) | 25 ppm | 35 ppm | 50 ppm |
| 메탄 (CH4) | 1% LEL | 10% LEL | 25% LEL |
| 전류 이상 | 정격 110% | 정격 130% | 정격 150% |

## 화면 구성 가이드

### 디바이스 관리 메인
```
┌──────────────────────────────────────────────────────┐
│ IoT 디바이스 관리                                     │
│ [스마트 조끼] [응급키트] [환경센서] ← 탭 전환           │
├──────────────────────────────────────────────────────┤
│  검색: [시리얼번호/작업자명] [모듈타입▼] [상태▼] 🔍    │
├────┬──────┬────────┬──────┬──────┬──────┬────────────┤
│ ID │시리얼 │모듈타입  │배정자 │배터리 │통신  │상태        │
│ 01 │SV-001│노지용   │홍길동 │🟢85% │🟢LTE│정상        │
│ 02 │SV-002│축산용   │김철수 │🟡32% │🟢LoRa│배터리부족  │
│ 03 │SV-003│과수용   │미배정 │---   │⚫OFF │미사용      │
├────┴──────┴────────┴──────┴──────┴──────┴────────────┤
│ [+ 조끼 등록] [배정 관리] [캘리브레이션 기록]           │
└──────────────────────────────────────────────────────┘
```

## 관련 API
| Method | Endpoint | 설명 |
|--------|----------|------|
| CRUD | `/api/v1/devices/vests` | 스마트 조끼 CRUD |
| GET | `/api/v1/devices/vests/{id}/status` | 조끼 실시간 상태 (배터리, 통신, 센서) |
| POST | `/api/v1/devices/vests/{id}/assign` | 작업자 배정 |
| CRUD | `/api/v1/devices/kits` | 응급키트 CRUD |
| GET | `/api/v1/devices/kits/{id}/events` | 개폐 이벤트 로그 |
| CRUD | `/api/v1/devices/sensors` | 환경센서 CRUD |
| GET | `/api/v1/devices/sensors/{id}/data?from=&to=` | 센서 데이터 조회 |
| PUT | `/api/v1/devices/sensors/{id}/threshold` | 임계값 설정 |

## 기술 구현 힌트
- **장비 목록**: 테이블 + 페이지네이션 + 필터링. 배터리/통신 상태는 색상 아이콘으로 직관적 표시
- **배터리 알림**: 30% 이하 시 노란색, 10% 이하 시 빨간색. 백엔드에서 주기적 체크 후 알림 발송
- **통신 상태**: 마지막 heartbeat 시간 기준. 5분 이상 미수신 시 "통신 끊김" 처리
- **환경 데이터 차트**: Recharts AreaChart, 임계값 구간을 색상 배경으로 표시
- **임계값 설정**: 폼 UI로 센서별 3단계(주의/경고/위험) 임계값 입력. 변경 시 즉시 적용
