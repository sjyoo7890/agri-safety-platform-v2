# FR-SYS: ì‹œìŠ¤í…œ ê´€ë¦¬ ë° ì¸ì¦

## ëª¨ë“ˆ ê°œìš”
ì‚¬ìš©ì ê³„ì • ê´€ë¦¬(RBAC), ë†ê°€/ë†ì‘ì—…ì¥ ë“±ë¡, ì¥ë¹„ ìì‚° ê´€ë¦¬, ì‹œìŠ¤í…œ ì„¤ì •, API í‚¤ ê´€ë¦¬, ê°ì‚¬ ë¡œê·¸, ë†ì—…ì¸ì•ˆì „365 ì—°ê³„ë¥¼ ê´€ë¦¬í•˜ëŠ” ëª¨ë“ˆ. ì „ì²´ ì‹œìŠ¤í…œì˜ ê¸°ë°˜ì´ ë˜ëŠ” ì²« ë²ˆì§¸ ê°œë°œ ëª¨ë“ˆ.

## ì ‘ê·¼ ê¶Œí•œ
- ì‹œìŠ¤í…œ ê´€ë¦¬ì: ì „ì²´ CRUD
- ë†ì¥ ê´€ë¦¬ì: ì†Œì† ë†ì¥ ì‚¬ìš©ì/ì¥ë¹„ ê´€ë¦¬ (ì œí•œì )
- ê¸°íƒ€ ì—­í• : ë³¸ì¸ í”„ë¡œí•„ ìˆ˜ì •ë§Œ

## ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­

| ID | ìš”êµ¬ì‚¬í•­ | ìš°ì„ ìˆœìœ„ | ìƒì„¸ ì„¤ëª… |
|----|---------|---------|----------|
| FR-SYS-001 | ì‚¬ìš©ì ê³„ì • ê´€ë¦¬ | ìƒ | ì‚¬ìš©ì ë“±ë¡/ìˆ˜ì •/ì‚­ì œ, ì—­í• (Role) ê¸°ë°˜ ì ‘ê·¼ ê¶Œí•œ ê´€ë¦¬ (RBAC) |
| FR-SYS-002 | ë†ê°€/ë†ì‘ì—…ì¥ ë“±ë¡ | ìƒ | ë†ê°€ ê¸°ë³¸ì •ë³´, ë†ì‘ì—…ì¥ ìœ„ì¹˜(GIS ì¢Œí‘œ), ì‘ëª© ìœ í˜•, ì‹œì„¤ ì •ë³´ ë“±ë¡ ê´€ë¦¬ |
| FR-SYS-003 | ì¥ë¹„ ìì‚° ê´€ë¦¬ | ìƒ | ìŠ¤ë§ˆíŠ¸ì¡°ë¼, ì‘ê¸‰í‚¤íŠ¸, í™˜ê²½ì„¼ì„œ, CCTV ë“± ì „ì²´ IoT ì¥ë¹„ì˜ ìì‚° ëŒ€ì¥ ê´€ë¦¬ |
| FR-SYS-004 | ì‹œìŠ¤í…œ ì„¤ì • | ìƒ | ì•Œë¦¼ ì„ê³„ê°’ ê¸°ë³¸ê°’, ë°ì´í„° ë³´ì¡´ ê¸°ê°„, ì‹œê°„ëŒ€ ì„¤ì • ë“± ê¸€ë¡œë²Œ ì„¤ì • ê´€ë¦¬ |
| FR-SYS-005 | API ê´€ë¦¬ | ì¤‘ | ì™¸ë¶€ ì‹œìŠ¤í…œ(ë†ê¸°ê³„ ì œì¡°ì‚¬, ì§€ìì²´ ê´€ì œì„¼í„°) ì—°ë™ì„ ìœ„í•œ Open API í‚¤ ë°œê¸‰ ë° ì‚¬ìš©ëŸ‰ ëª¨ë‹ˆí„°ë§ |
| FR-SYS-006 | ê°ì‚¬ ë¡œê·¸ | ìƒ | ì‚¬ìš©ì ë¡œê·¸ì¸, ì„¤ì • ë³€ê²½, ë°ì´í„° ì ‘ê·¼ ë“± ì£¼ìš” í™œë™ì— ëŒ€í•œ ê°ì‚¬ ë¡œê·¸ ê¸°ë¡ ë° ì¡°íšŒ |
| FR-SYS-007 | ë†ì—…ì¸ì•ˆì „365 ì—°ê³„ | ì¤‘ | ë†ì´Œì§„í¥ì²­ ë†ì—…ì¸ì•ˆì „365 í”Œë«í¼ê³¼ì˜ RESTful API ì—°ë™ ì„¤ì • ë° ìƒíƒœ ëª¨ë‹ˆí„°ë§ |

## ì¸ì¦/ì¸ê°€ ìƒì„¸ ì„¤ê³„

### ì¸ì¦ íë¦„
```
[ë¡œê·¸ì¸ ìš”ì²­] â†’ ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ ê²€ì¦ â†’ Access Token (15ë¶„) + Refresh Token (7ì¼) ë°œê¸‰
                                    â†’ Access Tokenì€ Authorization í—¤ë”
                                    â†’ Refresh Tokenì€ HttpOnly Cookie
[API ìš”ì²­] â†’ JWT ê²€ì¦ â†’ ì—­í• (Role) ê¸°ë°˜ ì ‘ê·¼ ì œì–´ (Guard)
[í† í° ë§Œë£Œ] â†’ Refresh Tokenìœ¼ë¡œ ìë™ ì¬ë°œê¸‰
[ë¡œê·¸ì•„ì›ƒ] â†’ Refresh Token ë¬´íš¨í™” (ë¸”ë™ë¦¬ìŠ¤íŠ¸)
```

### RBAC ì—­í• ë³„ ì ‘ê·¼ ê¶Œí•œ ë§¤íŠ¸ë¦­ìŠ¤

| ë¦¬ì†ŒìŠ¤ | admin | farm_manager | govt_manager | edu_manager | worker |
|--------|-------|-------------|-------------|-------------|--------|
| ì‚¬ìš©ì ê´€ë¦¬ | CRUD | Read (ì†Œì†) | Read (ê´€í• ) | - | ë³¸ì¸ |
| ë†ê°€/ì‘ì—…ì¥ | CRUD | Read/Update (ì†Œì†) | Read (ê´€í• ) | - | - |
| ì¥ë¹„ ê´€ë¦¬ | CRUD | Read/Update (ì†Œì†) | Read | - | Read (ë³¸ì¸) |
| ëŒ€ì‹œë³´ë“œ | Full | ì†Œì† ë†ì¥ | ê´€í•  ì§€ì—­ | - | - |
| ì•Œë¦¼ ì„¤ì • | CRUD | CRUD (ì†Œì†) | Read | - | - |
| ì•Œë¦¼ ì´ë ¥ | Full | ì†Œì† ë†ì¥ | ê´€í•  ì§€ì—­ | - | ë³¸ì¸ |
| ì‚¬ê³  ì´ë ¥ | CRUD | CRUD (ì†Œì†) | Read (ê´€í• ) | - | - |
| í†µê³„/ë¦¬í¬íŠ¸ | Full | ì†Œì† ë†ì¥ | ê´€í•  ì§€ì—­ | - | - |
| êµìœ¡ ê´€ë¦¬ | CRUD | Read (ì†Œì†) | Read (ê´€í• ) | CRUD | Read (ë³¸ì¸) |
| ì‹œìŠ¤í…œ ì„¤ì • | CRUD | - | - | - | - |
| API ê´€ë¦¬ | CRUD | - | - | - | - |
| ê°ì‚¬ ë¡œê·¸ | Read | - | - | - | - |

### ë¹„ë°€ë²ˆí˜¸ ì •ì±…
- ìµœì†Œ 8ì, ì˜ë¬¸ ëŒ€ì†Œë¬¸ì + ìˆ«ì + íŠ¹ìˆ˜ë¬¸ì ì¡°í•©
- bcrypt í•´ì‹œ (salt rounds: 12)
- ìµœê·¼ 5ê°œ ë¹„ë°€ë²ˆí˜¸ ì¬ì‚¬ìš© ê¸ˆì§€
- 90ì¼ ì£¼ê¸° ë³€ê²½ ê¶Œê³ 

## ë†ê°€/ë†ì‘ì—…ì¥ ë°ì´í„° êµ¬ì¡°

### ë†ê°€ (Farm)
| í•„ë“œ | ì„¤ëª… | íƒ€ì… | í•„ìˆ˜ |
|------|------|------|------|
| name | ë†ê°€ëª… | string | âœ… |
| owner_id | ëŒ€í‘œ ê´€ë¦¬ì | FK(User) | âœ… |
| address | ì£¼ì†Œ | string | âœ… |
| lat, lng | GPS ì¢Œí‘œ | float | âœ… |
| farm_type | ì‘ëª© ìœ í˜• (ë…¸ì§€/ì¶•ì‚°/ê³¼ìˆ˜/ì‹œì„¤ì›ì˜ˆ) | enum | âœ… |
| area | ë©´ì  (ã¡) | float | |
| phone | ì—°ë½ì²˜ | string | |

### ë†ì‘ì—…ì¥ (Workplace)
| í•„ë“œ | ì„¤ëª… | íƒ€ì… | í•„ìˆ˜ |
|------|------|------|------|
| farm_id | ì†Œì† ë†ê°€ | FK(Farm) | âœ… |
| name | ì‘ì—…ì¥ëª… (ì˜ˆ: "1ë²ˆ ë¹„ë‹í•˜ìš°ìŠ¤") | string | âœ… |
| type | ìœ í˜• (ë…¸ì§€/í•˜ìš°ìŠ¤/ì¶•ì‚¬/ê³¼ìˆ˜ì›/ì°½ê³ ) | enum | âœ… |
| lat, lng | ì¤‘ì‹¬ GPS ì¢Œí‘œ | float | âœ… |
| geofence_polygon | ì‘ì—…ì¥ ì˜ì—­ í´ë¦¬ê³¤ (GeoJSON) | json | |

## í™”ë©´ êµ¬ì„± ê°€ì´ë“œ

### ì‚¬ìš©ì ê´€ë¦¬
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ì‹œìŠ¤í…œ ê´€ë¦¬ > ì‚¬ìš©ì ê´€ë¦¬                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ê²€ìƒ‰: [ì´ë¦„/ì´ë©”ì¼] [ì—­í• â–¼] [ìƒíƒœâ–¼] ğŸ”  [+ ì‚¬ìš©ì ë“±ë¡]â”‚
â”œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ID â”‚ì´ë¦„   â”‚ì´ë©”ì¼       â”‚ì—­í•       â”‚ë†ì¥  â”‚ìƒíƒœ      â”‚
â”‚ 01 â”‚í™ê¸¸ë™ â”‚hong@...    â”‚ë†ì¥ê´€ë¦¬ì â”‚ë†ì¥A â”‚ğŸŸ¢ í™œì„±  â”‚
â”‚ 02 â”‚ê¹€ì² ìˆ˜ â”‚kim@...     â”‚ì‘ì—…ì    â”‚ë†ì¥A â”‚ğŸŸ¢ í™œì„±  â”‚
â”‚ 03 â”‚ì´ì˜í¬ â”‚lee@...     â”‚êµìœ¡ê´€ë¦¬ì â”‚-    â”‚ğŸŸ¡ ë¹„í™œì„± â”‚
â”œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ì‚¬ìš©ì ë“±ë¡] ëª¨ë‹¬                                    â”‚
â”‚  ì´ë¦„: [____] ì´ë©”ì¼: [____] ë¹„ë°€ë²ˆí˜¸: [____]          â”‚
â”‚  ì—­í• : [admin â–¼]  ì†Œì† ë†ì¥: [ì„ íƒ â–¼]                  â”‚
â”‚  ì—°ë½ì²˜: [____]                                       â”‚
â”‚  [ì·¨ì†Œ] [ë“±ë¡]                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ë†ê°€ ë“±ë¡
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ì‹œìŠ¤í…œ ê´€ë¦¬ > ë†ê°€/ë†ì‘ì—…ì¥ ê´€ë¦¬                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [+ ë†ê°€ ë“±ë¡] í¼                                     â”‚
â”‚  ë†ê°€ëª…: [____]  ëŒ€í‘œ ê´€ë¦¬ì: [ì„ íƒ â–¼]                  â”‚
â”‚  ì£¼ì†Œ: [____] [ì£¼ì†Œê²€ìƒ‰]                               â”‚
â”‚  ì‘ëª©ìœ í˜•: [ë…¸ì§€ â–¼]  ë©´ì : [____] ã¡                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚ ğŸ—ºï¸ ì§€ë„ì—ì„œ ì‘ì—…ì¥ ì˜ì—­ ì§€ì •       â”‚                â”‚
â”‚  â”‚   (í´ë¦¬ê³¤ ë“œë¡œì‰ ë„êµ¬)             â”‚                â”‚
â”‚  â”‚   ì‘ì—…ì¥1: 1ë²ˆ ë¹„ë‹í•˜ìš°ìŠ¤          â”‚                â”‚
â”‚  â”‚   ì‘ì—…ì¥2: ê³¼ìˆ˜ì› Aêµ¬ì—­           â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ê´€ë ¨ API

### ì¸ì¦
| Method | Endpoint | ì„¤ëª… |
|--------|----------|------|
| POST | `/api/v1/auth/login` | ë¡œê·¸ì¸ (ì´ë©”ì¼ + ë¹„ë°€ë²ˆí˜¸ â†’ JWT ë°œê¸‰) |
| POST | `/api/v1/auth/refresh` | Access Token ì¬ë°œê¸‰ |
| POST | `/api/v1/auth/logout` | ë¡œê·¸ì•„ì›ƒ (Refresh Token ë¬´íš¨í™”) |
| GET | `/api/v1/auth/me` | í˜„ì¬ ë¡œê·¸ì¸ ì‚¬ìš©ì ì •ë³´ |

### ì‚¬ìš©ì/ë†ê°€/ì¥ë¹„
| Method | Endpoint | ì„¤ëª… |
|--------|----------|------|
| CRUD | `/api/v1/users` | ì‚¬ìš©ì CRUD |
| CRUD | `/api/v1/farms` | ë†ê°€ CRUD |
| CRUD | `/api/v1/farms/{id}/workplaces` | ë†ì‘ì—…ì¥ CRUD |
| GET | `/api/v1/assets` | ì „ì²´ ì¥ë¹„ ìì‚° ëŒ€ì¥ ì¡°íšŒ |
| GET/PUT | `/api/v1/settings` | ì‹œìŠ¤í…œ ê¸€ë¡œë²Œ ì„¤ì • |
| CRUD | `/api/v1/api-keys` | Open API í‚¤ CRUD |
| GET | `/api/v1/api-keys/{key}/usage` | API ì‚¬ìš©ëŸ‰ ì¡°íšŒ |
| GET | `/api/v1/audit-logs?from=&to=&user_id=&action=` | ê°ì‚¬ ë¡œê·¸ ì¡°íšŒ |

## ê¸°ìˆ  êµ¬í˜„ íŒíŠ¸

### NestJS ì¸ì¦ êµ¬í˜„
```
- @nestjs/passport + passport-jwt ì „ëµ
- @nestjs/jwtë¡œ í† í° ë°œê¸‰
- Custom Guard: JwtAuthGuard (ì¸ì¦), RolesGuard (ì¸ê°€)
- Custom Decorator: @Roles('admin', 'farm_manager'), @CurrentUser()
- Refresh Token: Redisì— ì €ì¥, ë¡œê·¸ì•„ì›ƒ ì‹œ ì‚­ì œ
```

### ê°ì‚¬ ë¡œê·¸
```
- NestJS Interceptorë¡œ ëª¨ë“  API ìš”ì²­ ìë™ ê¸°ë¡
- ê¸°ë¡ í•­ëª©: user_id, action, resource, resource_id, ip, timestamp, changes (before/after)
- 90ì¼ ì´ìƒ ë³´ì¡´, ì‚­ì œ ë¶ˆê°€ (append-only)
```

### ë†ê°€ ì§€ë„
```
- react-leaflet + Leaflet.draw í”ŒëŸ¬ê·¸ì¸ìœ¼ë¡œ í´ë¦¬ê³¤ ë“œë¡œì‰
- GeoJSON í˜•ì‹ìœ¼ë¡œ ì‘ì—…ì¥ ì˜ì—­ ì €ì¥
- ì£¼ì†Œ â†’ ì¢Œí‘œ ë³€í™˜: Kakao Maps API ë˜ëŠ” OpenStreetMap Nominatim
```
